<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta author="Carson Woods">
    <title>Ad Fraud</title>
    <link rel="stylesheet" href="css/main.css">

    <script type="application/javascript">

    //Global Variables
    var width; //canvas width
    var height; //canvas height
    var canvas; //the canvas
    var ctx;  //the context
    var currentScene = 3; //leave uninitialized to start from beginning
    var intervals = []; //sets intervals for later clearing

    //image variables
    var overview = new Image();

    //adds event listener on the window load so the system doesn't prematurely try
    //to load the canvas and context.
    window.addEventListener('load', eventWindowLoaded, false);

    function eventWindowLoaded() {
      //sets canvas and context based on the DOM element Canvas
      canvas = document.getElementById('canvas')
      ctx = canvas.getContext('2d');
      width = canvas.width;
      height = canvas.height;
    }

    function init() {


      //load assets for images from CDN.
      //Note: Local storage is possible but behaves poorly when running from dev console
      overview.src = './assets/overview.png';



      //loads the first scene
      if (currentScene === 1) {
        sceneOne();
      } else if (currentScene === 2) {
        sceneTwo();
      } else if (currentScene === 3) {
        sceneThree();
      } else if (currentScene === 4) {
        sceneFour();
      } else if (currentScene === 5) {
        sceneFive();
      } else if (currentScene === 6) {
        sceneSix();
      } else {
        sceneOne();
      }

    }

    function sceneOne() {
      //sets the current scene
      currentScene = 1;

      //clears any previous drawings
      ctx.clearRect(0,0,width,height);

      //sets font and font size for the following text
      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("Ad Fraud Prevention", 200, 200);
      ctx.fillText("An Interactive Demo", 200, 450);
      var sceneOneTimer = setInterval(function(){
        fadeIn("Use the arrow keys to continue", 250, 300, 20, width);
        clearInterval(sceneOneTimer);
      }, 2000)
      intervals.push(sceneOneTimer);

      //tests for next scene input key
      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key == 39) {
          intervals.forEach(clearInterval);
          sceneTwo();
        }

      }

    }

    function sceneTwo() {
      //sets the current scene
      currentScene = 2;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "50pt Arial";
      ctx.fillText("Introduction", 275, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {

          if (subSection === 0) {
            fadeIn("Online Advertisement has Significantly changed", 175, 150, 20, width);
            fadeIn("the landscape of the advertisement industry", 190, 180, 20, width);
            subSection++;
          } else if(subSection === 1) {
            intervals.forEach(clearInterval);
            fadeIn("Benefits Include: ", 140, 220, 15, width);
            subSection++;
          } else if(subSection === 2) {
            fadeIn("- Cost Efficiency", 160, 245, 12, width);
            fadeIn("- Convenience in targeting relevant market segment", 160, 270, 12, width);
            fadeIn("- Ability to quickly disseminate content changes", 160, 295, 12, width);
            fadeIn("- Track consumers in real time", 160, 320, 12, width);
            subSection++;
          } else if(subSection === 3) {
            intervals.forEach(clearInterval);
            fadeIn("Benefits come with Challenges:", 140, 350, 15, width);
            subSection++;
          } else if (subSection === 4) {
            fadeIn("- Click Fraud", 160, 375, 12, width);
            fadeIn("- Ad Replacement", 160, 400, 12, width);
            fadeIn("- Ad Stacking", 160, 425, 12, width);
            subSection++;
          } else if (subSection === 5) {
            intervals.forEach(clearInterval);
            ctx.fillStyle = "rgba(0, 0, 0, 1)";
            ctx.font = "15pt Arial";
            ctx.fillText("Press the right arrow key to continue", 550, 550);
            subSection++;
          } else if (subSection === 6) {
            intervals.forEach(clearInterval);
            sceneThree();
          }
        }

        if (key === 37) {
          if (subSection === 0) {
            sceneOne();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(150, 110, width, 80);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(140, 205, width, 20);
            subSection--;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            ctx.clearRect(120, 230, width, 1250);
            subSection--;
          } else if (subSection === 4) {
            intervals.forEach(clearInterval);
            ctx.clearRect(80, 325, width, 40);
            subSection--;
          } else if (subSection === 5) {
            intervals.forEach(clearInterval);
            ctx.clearRect(120, 360, width, 100);
            subSection--;
          } else if (subSection === 6) {
            intervals.forEach(clearInterval);
            ctx.clearRect(550, 510, 400, 50);
            subSection--;
          }
        }

      }

    }

    function sceneThree() {
      //sets the current scene
      currentScene = 3;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("Online Advertisement Overview", 100, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {

          if (subSection === 0) {
            intervals.forEach(clearInterval);
            fadeIn("Parties Involved", 150, 130, 20, width);
            subSection++;
          } else if(subSection === 1) {
            intervals.forEach(clearInterval);
            fadeIn("Advertisers: entity who would like to advertise their product", 160, 155, 12, width);
            fadeIn("Publisher: website owners hosting the ad", 160, 180, 12, width);
            fadeIn("Ad Network: Mediator between publisher and advertiser", 160, 205, 12, width);
            subSection++;
          } else if(subSection === 2) {
            intervals.forEach(clearInterval);
            fadeIn("Advertisers pay Ad Network", 20, 395, 12, 225);
            fadeIn("for displaying their ads", 20, 420, 12, 225);
            fadeIn("Ad Network split revenue generated", 20, 450, 12, 275);
            fadeIn("by ads with the publisers", 20, 480, 12, 275);
            fadeIn("Advertisers", 715, 320, 12, 225);
            fadeIn("Publishers", 715, 480, 12, 225);
            ctx.drawImage(overview, 300, 300, 400, 200);
            subSection++;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            sceneFour();
          }
        }
        if (key === 37) {
          if (subSection === 0) {
            sceneTwo();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(150, 110, width, 80);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(120, 140, width, 400);
            subSection--;
          } else if (subSection === 3) {
            ctx.clearRect(0, 210, width, 500);
            intervals.forEach(clearInterval);
            subSection--;
          }
        }
      }
    }

    function sceneFour() {
      //sets the current scene
      currentScene = 4;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("Advertisement Revenue Model", 100, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {

          if (subSection === 0) {
            intervals.forEach(clearInterval);
            fadeIn("Parties Involved", 150, 130, 20, width);
            subSection++;
          } else if(subSection === 1) {
            intervals.forEach(clearInterval);
            fadeIn("Advertisers: entity who would like to advertise their product", 160, 155, 12, width);
            fadeIn("Publisher: website owners hosting the ad", 160, 180, 12, width);
            fadeIn("Ad Network: Mediator between publisher and advertiser", 160, 205, 12, width);
            subSection++;
          } else if(subSection === 2) {
            intervals.forEach(clearInterval);
            fadeIn("Advertisers pay Ad Network", 20, 395, 12, 225);
            fadeIn("for displaying their ads", 20, 420, 12, 225);
            fadeIn("Ad Network split revenue generated", 20, 450, 12, 275);
            fadeIn("by ads with the publisers", 20, 480, 12, 275);
            ctx.drawImage(overview, 300, 300, 400, 200);
            subSection++;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            sceneThree();
          }
        }

        if (key === 37) {
          if (subSection === 0) {
            sceneTwo();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(150, 110, width, 80);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(140, 205, width, 20);
            subSection--;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            ctx.clearRect(120, 230, width, 1250);
            subSection--;
          } else if (subSection === 4) {
            intervals.forEach(clearInterval);
            ctx.clearRect(80, 325, width, 40);
            subSection--;
          } else if (subSection === 5) {
            intervals.forEach(clearInterval);
            ctx.clearRect(120, 360, width, 100);
            subSection--;
          } else if (subSection === 6) {
            intervals.forEach(clearInterval);
            ctx.clearRect(550, 510, 400, 50);
            subSection--;
          }
        }

      }
    }

    //building animation for text fading in
    function fadeIn(text, x, y, fontSize, textWidth) {
      var aNumber = 1;
      var alpha = 0.0;
      fadeInInterval = setInterval(function () {
        ctx.clearRect(x, y-fontSize-5, textWidth, fontSize+15); // Clears the canvas
        ctx.fillStyle = "rgba(0, 0, 0, " + alpha + ")";
        ctx.font = fontSize + "pt Arial";
        ctx.fillText(text, x, y);
        alpha = alpha + 0.05; // increase opacity (fade in)

        if (alpha > 1) {
          clearInterval(fadeInInterval);
        }
      }, 70);
      intervals.push(fadeInInterval);
    }

    //text fade out animation
    function fadeOut(text, x, y, fontSize, textWidth) {
      var alpha = 1.0;   // full opacity
      fadeOutInterval = setInterval(function () {
        ctx.clearRect(x, y-fontSize-5, textWidth, fontSize+15); // Clears the canvas
        ctx.fillStyle = "rgba(0, 0, 0, " + alpha + ")";
        ctx.font = fontSize + "pt Arial";
        ctx.fillText(text, x, y);
        alpha = alpha - 0.05; // decrease opacity (fade out)
        if (alpha < 0) {
          ctx.clearRect(x, y-fontSize-5, textWidth, fontSize+15);
          clearInterval(fadeOutInterval);
        }
      }, 100);

      intervals.push(fadeOutInterval);
    }

    function lineDraw(startX, startY, endX, endY) {
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      ctx.lineTo(endX, endY);
      ctx.stroke();
    }

    //give direction 0 if left and direction 1 if right
    function lineDrawDirection(startX, startY, endX, endY, direction) {
      //draws the line
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      ctx.lineTo(endX, endY);
      ctx.stroke();

      //draws the triangle part of the arrow
      if (direction == 0) {
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(startX+15, startY-15);
        ctx.lineTo(startX+15, startY+15);
        ctx.fill();
      } else if (direction == 1) {
        ctx.beginPath();
        ctx.moveTo(endX, endY);
        ctx.lineTo(endX-15, startY-15);
        ctx.lineTo(endX-15, startY+15);
        ctx.fill();
      }
    }

    //this is a long function that I think can be abstracted later but I don't
    //want to deal with that right now so here it is
    function moveImage(image, startX, startY, endX, endY, imageWidth, imageHeight) {

      var currentX = startX;
      var currentY = startY;

      moveTimer = setInterval(function() {
        //I added +/- 1 because in some cases it wasn't completely clearing the old image
        ctx.clearRect(currentX-1, currentY-1, imageWidth+1, imageHeight+1);
        ctx.drawImage(image, currentX, currentY, imageWidth, imageHeight);

        if (endX > currentX) {
          currentX++;
        } else if(endX < currentX) {
          currentX--;
        }

        if (endY > currentY) {
          currentY++;
        } else if(endY < currentY) {
          currentY--;
        }

        if (currentX === endX && currentY === endY) {
          clearInterval(moveTimer);
        }

      }, 6)
      intervals.push(moveTimer);
    }

    //fades in images
    function imageFadeIn(image, x, y, w, h) {
      var alpha = 0.0;

      fadeInImageInterval = setInterval(function() {
        ctx.clearRect(x-1, y-1, w+1, h+1);
        ctx.globalAlpha = alpha;
        ctx.drawImage(image, x, y, w, h);
        alpha += .05;

        if (alpha > 1) {
          //resets globalAlpha
          ctx.globalAlpha = 1;
          clearInterval(fadeInImageInterval);
        }

      }, 99)

      intervals.push(fadeInImageInterval);
    }

    function imageFadeOut(image, x, y, w, h) {
      var alpha = 1.0;
      ctx.drawImage(image, x, y, w, h);
      fadeOutImageInterval = setInterval(function() {
        ctx.clearRect(x-1, y-1, w+1, h+1);
        ctx.globalAlpha = alpha;
        ctx.drawImage(image, x, y, w, h);
        alpha -= .05;

        if (alpha < 0) {
          ctx.globalAlpha = 1;
          ctx.clearRect(x-1, y-1, w+1, h+1);
          clearInterval(fadeOutImageInterval);
        }

      }, 99)

      intervals.push(fadeOutImageInterval);
    }

    </script>

  </head>




  <body onLoad="init();">
  <div id="canvas-div">
    <canvas id="canvas" width="900" height="600"></canvas>
  </div>
  </body>
  </html>
