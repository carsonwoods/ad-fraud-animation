<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta author="Carson Woods">
    <title>Ad Fraud</title>
    <link rel="stylesheet" href="css/main.css">

    <script type="application/javascript">

    //Global Variables
    var width; //canvas width
    var height; //canvas height
    var canvas; //the canvas
    var ctx;  //the context
    var currentScene = 10; //leave uninitialized to start from beginning
    var intervals = []; //sets intervals for later clearing

    //image variables
    var overview = new Image();
    var archictecture = new Image();
    var validAdvertisement = new Image();
    var spoofedAdvertisement = new Image();
    var arrowImage = new Image();
    var user = new Image();
    var localDNS = new Image();
    var webServer = new Image();
    var attacker = new Image();
    var internetDNS = new Image();

    //adds event listener on the window load so the system doesn't prematurely try
    //to load the canvas and context.
    window.addEventListener('load', eventWindowLoaded, false);

    function eventWindowLoaded() {
      //sets canvas and context based on the DOM element Canvas
      canvas = document.getElementById('canvas')
      ctx = canvas.getContext('2d');
      width = canvas.width;
      height = canvas.height;
    }

    function init() {


      //load assets for images from CDN.
      //Note: Local storage is possible but behaves poorly when running from dev console
      overview.src = './assets/overview.png';
      archictecture.src = './assets/architecture.png';
      validAdvertisement.src = './assets/validAdvertisement.png';
      spoofedAdvertisement.src = './assets/spoofedAdvertisement.png';
      arrowImage.src = './assets/arrow.png';
      user.src = './assets/user.png';
      localDNS.src = './assets/localDNS.png';
      webServer.src = './assets/webServer.png';
      attacker.src = './assets/attacker.png';
      internetDNS.src = './assets/internetDNS.png';


      //loads the first scene
      if (currentScene === 1) {
        sceneOne();
      } else if (currentScene === 2) {
        sceneTwo();
      } else if (currentScene === 3) {
        sceneThree();
      } else if (currentScene === 4) {
        sceneFour();
      } else if (currentScene === 5) {
        sceneFive();
      } else if (currentScene === 6) {
        sceneSix();
      } else if (currentScene === 7) {
        sceneSeven();
      } else if (currentScene === 8) {
        sceneEight();
      } else if (currentScene === 9) {
        sceneNine();
      } else if (currentScene === 10) {
        sceneTen();
      } else {
        sceneOne();
      }

    }

    function sceneOne() {
      //sets the current scene
      currentScene = 1;

      //clears any previous drawings
      ctx.clearRect(0,0,width,height);

      //sets font and font size for the following text
      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("Ad Fraud Prevention", 200, 200);
      ctx.fillText("An Interactive Demo", 200, 450);
      var sceneOneTimer = setInterval(function(){
        fadeIn("Use the arrow keys to continue", 250, 300, 20, width);
        clearInterval(sceneOneTimer);
      }, 2000)
      intervals.push(sceneOneTimer);

      //tests for next scene input key
      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key == 39) {
          intervals.forEach(clearInterval);
          sceneTwo();
        }

      }

    }

    function sceneTwo() {
      //sets the current scene
      currentScene = 2;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "50pt Arial";
      ctx.fillText("Introduction", 275, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {

          if (subSection === 0) {
            fadeIn("Online Advertisement has Significantly changed", 175, 150, 20, width);
            fadeIn("the landscape of the advertisement industry", 190, 180, 20, width);
            subSection++;
          } else if(subSection === 1) {
            intervals.forEach(clearInterval);
            fadeIn("Benefits Include: ", 140, 220, 15, width);
            subSection++;
          } else if(subSection === 2) {
            fadeIn("- Cost Efficiency", 160, 245, 12, width);
            fadeIn("- Convenience in targeting relevant market segment", 160, 270, 12, width);
            fadeIn("- Ability to quickly disseminate content changes", 160, 295, 12, width);
            fadeIn("- Track consumers in real time", 160, 320, 12, width);
            subSection++;
          } else if(subSection === 3) {
            intervals.forEach(clearInterval);
            fadeIn("Benefits come with Challenges:", 140, 350, 15, width);
            subSection++;
          } else if (subSection === 4) {
            fadeIn("- Click Fraud", 160, 375, 12, width);
            fadeIn("- Ad Replacement", 160, 400, 12, width);
            fadeIn("- Ad Stacking", 160, 425, 12, width);
            subSection++;
          } else if (subSection === 5) {
            intervals.forEach(clearInterval);
            ctx.fillStyle = "rgba(0, 0, 0, 1)";
            ctx.font = "15pt Arial";
            ctx.fillText("Press the right arrow key to continue", 550, 550);
            subSection++;
          } else if (subSection === 6) {
            intervals.forEach(clearInterval);
            sceneThree();
          }
        }

        if (key === 37) {
          if (subSection === 0) {
            sceneOne();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(150, 110, width, 80);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(140, 205, width, 20);
            subSection--;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            ctx.clearRect(120, 230, width, 1250);
            subSection--;
          } else if (subSection === 4) {
            intervals.forEach(clearInterval);
            ctx.clearRect(80, 325, width, 40);
            subSection--;
          } else if (subSection === 5) {
            intervals.forEach(clearInterval);
            ctx.clearRect(120, 360, width, 100);
            subSection--;
          } else if (subSection === 6) {
            intervals.forEach(clearInterval);
            ctx.clearRect(550, 510, 400, 50);
            subSection--;
          }
        }

      }

    }

    function sceneThree() {
      //sets the current scene
      currentScene = 3;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("Online Advertisement Overview", 100, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {

          if (subSection === 0) {
            intervals.forEach(clearInterval);
            fadeIn("Parties Involved", 150, 130, 20, width);
            subSection++;
          } else if(subSection === 1) {
            intervals.forEach(clearInterval);
            fadeIn("Advertisers: entity who would like to advertise their product", 160, 155, 12, width);
            fadeIn("Publisher: website owners hosting the ad", 160, 180, 12, width);
            fadeIn("Ad Network: Mediator between publisher and advertiser", 160, 205, 12, width);
            subSection++;
          } else if(subSection === 2) {
            intervals.forEach(clearInterval);
            fadeIn("Advertisers pay Ad Network", 20, 395, 12, 225);
            fadeIn("for displaying their ads", 20, 420, 12, 225);
            fadeIn("Ad Network split revenue generated", 20, 450, 12, 275);
            fadeIn("by ads with the publisers", 20, 480, 12, 275);
            fadeIn("Advertisers", 715, 320, 12, 225);
            fadeIn("Publishers", 715, 480, 12, 225);
            ctx.drawImage(overview, 300, 300, 400, 200);
            subSection++;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            sceneFour();
          }
        }
        if (key === 37) {
          if (subSection === 0) {
            sceneTwo();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(150, 110, width, 80);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(120, 140, width, 400);
            subSection--;
          } else if (subSection === 3) {
            ctx.clearRect(0, 210, width, 500);
            intervals.forEach(clearInterval);
            subSection--;
          }
        }
      }
    }

    function sceneFour() {
      //sets the current scene
      currentScene = 4;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("Advertisement Revenue Model", 100, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {

          if (subSection === 0) {
            intervals.forEach(clearInterval);
            fadeIn("Common Revenue Types", 50, 130, 20, width);
            subSection++;
          } else if(subSection === 1) {
            intervals.forEach(clearInterval);
            fadeIn("Cost per mille (CPM) : Amount advertisers are charged per thousand views or impressions", 80, 155, 15, width);
            fadeIn("Cost per click (CPC) :  Amount advertisers are charged per click", 80, 180, 15, width);
            fadeIn("Cost per action (CPA) : Amount advertisers are charged per action, e.g. Online Sale", 80, 205, 15, width);
            subSection++;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            sceneFive();
          }
        }

        if (key === 37) {
          if (subSection === 0) {
            sceneThree();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0, 110, width, 80);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0, 140, width, 200);
            subSection--;
          }
        }

      }
    }

    function sceneFive() {
      //sets the current scene
      currentScene = 5;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("Ad Serving Architecture", 175, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {

          if (subSection === 0) {
            intervals.forEach(clearInterval);
            ctx.drawImage(archictecture, 125, 100, 700, 500);
            subSection++;
          } else if(subSection === 1) {
            intervals.forEach(clearInterval);
            sceneSix();
            subSection++;
          }
        }

        if (key === 37) {
          if (subSection === 0) {
            sceneFour();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0, 100, width, height);
            subSection--;
          }
        }

      }
    }

    function sceneSix() {
      //sets the current scene
      currentScene = 6;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("Ad Replacement Attack", 175, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {

          if(subSection === 0) {
            intervals.forEach(clearInterval);
            fadeIn("Attackers are malicious publishers who infected the victim machine", 150, 155, 15, width);
            fadeIn("with DNS Changer malware", 150, 180, 15, width);
            subSection++;
          } else if(subSection === 1) {
            intervals.forEach(clearInterval);
            fadeIn("Together with Rogue DNS Servers, the attackers replaced", 150, 220, 15, width);
            fadeIn("legitimate ads on websites with attacker’s ads", 150, 245, 15, width);
            subSection++;
          } else if(subSection === 2) {
            intervals.forEach(clearInterval);
            fadeIn("Ad Fraud helped attackers earn 14 million USD over a period of 4 years", 150, 285, 15, width);
            subSection++;
          } else if(subSection === 3) {
            intervals.forEach(clearInterval);
            sceneSeven();
          }
        }

        if (key === 37) {
          if (subSection === 0) {
            sceneFive();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.drawImage(validAdvertisement, 0, 100, 300, 300);
            ctx.clearRect(0, 100, width, height);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0, 185, width, height);
            subSection--;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0, 250, width, height);
            subSection--;
          }
        }

      }
    }

    function sceneSeven() {
      //sets the current scene
      currentScene = 7;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("Ad Replacement Attack Example", 75, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {

          if(subSection === 0) {
            intervals.forEach(clearInterval);
            fadeIn("Intended Advertisement", 100, 160, 15, width);
            ctx.drawImage(validAdvertisement, 50, 175, 300, 300);
            subSection++;
          } else if(subSection === 1) {
            intervals.forEach(clearInterval);
            fadeIn("Fradulant Advertisement", 600, 160, 15, width);
            ctx.drawImage(arrowImage, 400, 300, 100, 50);
            ctx.drawImage(spoofedAdvertisement, 550, 175, 300, 300);
            subSection++;
          } else if(subSection === 2) {
            intervals.forEach(clearInterval);
            sceneEight();
          }
        }

        if (key === 37) {
          if (subSection === 0) {
            sceneSix();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0, 100, width, height);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(400, 145, width, height);
            subSection--;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0, 250, width, height);
            subSection--;
          }
        }

      }
    }

    function sceneEight() {
      //sets the current scene
      currentScene = 8;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("Domain Name System", 180, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {
          if(subSection === 0) {
            intervals.forEach(clearInterval);
            fadeIn("One major source for ad fraud occurs in insecure DNS servers.", 160, 110, 15, width);
            subSection++;
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            fadeIn("DNS translates internet domains and host names to ip addresses.", 160, 140, 15, width);
            subSection++;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.drawImage(user, 50, 475, 100, 100);
            ctx.fillText("User", 50, 585);
            ctx.drawImage(webServer, 400, 175, 100, 100);
            ctx.fillText("Web Server", 400, 290);
            ctx.drawImage(localDNS, 750, 475, 100, 100);
            ctx.fillText("Local DNS Server", 730, 580);
            subSection++;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval)
            lineDraw(160, 500, 740, 500);
            fadeIn("1. User’s browser requests for IP address of ebay.com", 200, 485, 12, 400);
            subSection++;
          } else if (subSection === 4) {
            intervals.forEach(clearInterval)
            lineDraw(160, 550, 740, 550);
            fadeIn("2.DNS returns the IP Address to the user 66.135.217.240", 200, 570, 12, 425);
            subSection++;
          } else if (subSection === 5) {
            intervals.forEach(clearInterval);
            fadeIn("3. User’s browser accesses the website", 50, 200, 12, 290);
            fadeIn("by sending HTTP request to ", 50, 225, 12, 250);
            fadeIn("66.135.217.240 Web Server", 50, 250, 12, 250);
            lineDraw(50, 475, 400, 190);
            subSection++;
          } else if (subSection === 6) {
            intervals.forEach(clearInterval);
            lineDraw(150, 475, 400, 290);
            fadeIn("4. Web Server sends HTTP ", 350, 365, 12, 200);
            fadeIn("response to the User", 350, 390, 12, 200);
            subSection++;
          } else if (subSection === 7) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0, 0, width, height);
            sceneNine();
          }
        }

        if (key === 37) {
          if (subSection === 0) {
            sceneSeven();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(160, 90, width, height);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(160, 120, width, height);
            subSection--;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0, 175, width, height);
            subSection--;
          } else if (subSection === 4) {
            intervals.forEach(clearInterval);
            ctx.clearRect(160, 465, 590, 40)
            subSection--;
          } else if (subSection === 5) {
            intervals.forEach(clearInterval);
            ctx.clearRect(160, 520, 590, 40)
            ctx.clearRect(160, 550, 500, 40)
            subSection--;
          } else if (subSection === 6) {
            intervals.forEach(clearInterval)
            ctx.clearRect(50, 180, 350, 290);
            ctx.clearRect(50, 180, 50, 300);
            subSection--;
          } else if (subSection === 7) {
            intervals.forEach(clearInterval);
            ctx.clearRect(290, 289, 300, 180);
            ctx.clearRect(190, 365, 110, 100);
            ctx.clearRect(125, 425, 75, 55);
            subSection--;
          }
        }

      }
    }

    function sceneNine() {
      //sets the current scene
      currentScene = 9;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "40pt Arial";
      ctx.fillText("DNS Cache Poisoning", 180, 75);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {
          if(subSection === 0) {
            intervals.forEach(clearInterval);
            fadeIn("This is a computer hacking attack where a hacker floods", 125, 125, 20, width);
            fadeIn("a DNS Cache with fake IP Addresses.", 220, 160, 20, width)
            subSection++;
          } else if(subSection === 1) {
            intervals.forEach(clearInterval);
            fadeIn("Local DNS Server- Keeps the IP Addresses which user uses frequently. ", 25, 225, 20, width);
            fadeIn("If user asks IP address of a web server which is not ", 115, 260, 20, width)
            fadeIn("stored in Local DNS Server, it queries the Internet DNS Server.", 80, 295, 20, width)
            subSection++;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            fadeIn("Internet DNS Server- It stores all the Web server", 150, 360, 20, width)
            fadeIn("names and their corresponding IP Address", 180, 390, 20, width)
            subSection++;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            sceneTen();
          }
        }

        if (key === 37) {
          if (subSection === 0) {
            sceneEight();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0,100,width,height);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0,200,width,height);
            subSection--;
          } else if (subSection === 3) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0,300,width,height);
            subSection--;
          }
        }

      }
    }

    function sceneTen() {
      //sets the current scene
      currentScene = 10;

      //clears canvas
      ctx.clearRect(0,0,width,height);

      ctx.fillStyle = "rgba(0, 0, 0, 1)";
      ctx.font = "30pt Arial";
      ctx.fillText("DNS Cache Poisoning", 250, 50);

      //incrementable flag to determine progress through scene
      var subSection = 0;

      window.onkeyup = function(e) {
        var key = e.keyCode ? e.keyCode : e.which;

        if (key === 39) {
          if(subSection === 0) {
            intervals.forEach(clearInterval);
            ctx.drawImage(attacker, 50, 440, 125, 100);
            ctx.drawImage(localDNS, 750, 440, 125, 100);
            ctx.font = "15pt Arial";
            ctx.fillText("Attacker", 70, 590);
            ctx.fillText("Local DNS", 750, 590);
            subSection++;
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.drawImage(attacker, 50, 440, 125, 100);
            ctx.drawImage(localDNS, 750, 440, 125, 100);
            lineDraw(200, 480, 700, 480);
            fadeIn("1. Resolve IP address of http://maddox.xmission.com", 225, 460, 13, 450);
            fadeIn("Step 1: Attacker chooses a website and asks Local DNS server for the IP address", 125, 100, 13, 675);
            fadeIn("For e.g. http://maddox.xmission.com, hoping that it will query Internet DNS Server.", 125, 125, 13, 675);
            subSection++;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.drawImage(attacker, 50, 440, 125, 100);
            ctx.drawImage(localDNS, 750, 440, 125, 100);
            ctx.drawImage(internetDNS, 400, 150, 100, 100);
            ctx.clearRect(200,400,500,150);
            ctx.clearRect(0, 75, width, 60);
            ctx.font = "15pt Arial";
            ctx.fillText("Attacker", 70, 590);
            ctx.fillText("Local DNS", 750, 590);
            ctx.fillText("Internet DNS", 390, 290);
            lineDraw()
            fadeIn("Step 2: If Local DNS Server will not have the IP Address of the requested website,", 125, 100, 13, 675);
            fadeIn("Local DNS Server will query Internet DNS Server for the IP Address. ", 125, 125, 13, 675);
            subSection++;
          }
        }

        if (key === 37) {
          if (subSection === 0) {
            sceneNine();
          } else if (subSection === 1) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0,100,width,height);
            subSection--;
          } else if (subSection === 2) {
            intervals.forEach(clearInterval);
            ctx.clearRect(0,75,width,150);
            ctx.clearRect(200,400,500,150);
            subSection--;
          }
        }

      }
    }


    //building animation for text fading in
    function fadeIn(text, x, y, fontSize, textWidth) {
      var aNumber = 1;
      var alpha = 0.0;
      fadeInInterval = setInterval(function () {
        ctx.clearRect(x, y-fontSize-5, textWidth, fontSize+15); // Clears the canvas
        ctx.fillStyle = "rgba(0, 0, 0, " + alpha + ")";
        ctx.font = fontSize + "pt Arial";
        ctx.fillText(text, x, y);
        alpha = alpha + 0.05; // increase opacity (fade in)

        if (alpha > 1) {
          clearInterval(fadeInInterval);
        }
      }, 70);
      intervals.push(fadeInInterval);
    }

    //text fade out animation
    function fadeOut(text, x, y, fontSize, textWidth) {
      var alpha = 1.0;   // full opacity
      fadeOutInterval = setInterval(function () {
        ctx.clearRect(x, y-fontSize-5, textWidth, fontSize+15); // Clears the canvas
        ctx.fillStyle = "rgba(0, 0, 0, " + alpha + ")";
        ctx.font = fontSize + "pt Arial";
        ctx.fillText(text, x, y);
        alpha = alpha - 0.05; // decrease opacity (fade out)
        if (alpha < 0) {
          ctx.clearRect(x, y-fontSize-5, textWidth, fontSize+15);
          clearInterval(fadeOutInterval);
        }
      }, 100);

      intervals.push(fadeOutInterval);
    }

    function lineDraw(startX, startY, endX, endY) {
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      ctx.lineTo(endX, endY);
      ctx.stroke();
    }

    //give direction 0 if left and direction 1 if right
    function lineDrawDirection(startX, startY, endX, endY, direction) {
      //draws the line
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      ctx.lineTo(endX, endY);
      ctx.stroke();

      //draws the triangle part of the arrow
      if (direction == 0) {
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(startX+15, startY-15);
        ctx.lineTo(startX+15, startY+15);
        ctx.fill();
      } else if (direction == 1) {
        ctx.beginPath();
        ctx.moveTo(endX, endY);
        ctx.lineTo(endX-15, startY-15);
        ctx.lineTo(endX-15, startY+15);
        ctx.fill();
      }
    }

    //this is a long function that I think can be abstracted later but I don't
    //want to deal with that right now so here it is
    function moveImage(image, startX, startY, endX, endY, imageWidth, imageHeight) {

      var currentX = startX;
      var currentY = startY;

      moveTimer = setInterval(function() {
        //I added +/- 1 because in some cases it wasn't completely clearing the old image
        ctx.clearRect(currentX-1, currentY-1, imageWidth+1, imageHeight+1);
        ctx.drawImage(image, currentX, currentY, imageWidth, imageHeight);

        if (endX > currentX) {
          currentX++;
        } else if(endX < currentX) {
          currentX--;
        }

        if (endY > currentY) {
          currentY++;
        } else if(endY < currentY) {
          currentY--;
        }

        if (currentX === endX && currentY === endY) {
          clearInterval(moveTimer);
        }

      }, 6)
      intervals.push(moveTimer);
    }

    //fades in images
    function imageFadeIn(image, x, y, w, h) {
      var alpha = 0.0;

      fadeInImageInterval = setInterval(function() {
        ctx.clearRect(x-1, y-1, w+1, h+1);
        ctx.globalAlpha = alpha;
        ctx.drawImage(image, x, y, w, h);
        alpha += .05;

        if (alpha > 1) {
          //resets globalAlpha
          ctx.globalAlpha = 1;
          clearInterval(fadeInImageInterval);
        }

      }, 99)

      intervals.push(fadeInImageInterval);
    }

    function imageFadeOut(image, x, y, w, h) {
      var alpha = 1.0;
      ctx.drawImage(image, x, y, w, h);
      fadeOutImageInterval = setInterval(function() {
        ctx.clearRect(x-1, y-1, w+1, h+1);
        ctx.globalAlpha = alpha;
        ctx.drawImage(image, x, y, w, h);
        alpha -= .05;

        if (alpha < 0) {
          ctx.globalAlpha = 1;
          ctx.clearRect(x-1, y-1, w+1, h+1);
          clearInterval(fadeOutImageInterval);
        }

      }, 99)

      intervals.push(fadeOutImageInterval);
    }

    </script>

  </head>

  <body onLoad="init();">
  <div id="canvas-div">
    <canvas id="canvas" width="900" height="600"></canvas>
  </div>
  </body>
  </html>
